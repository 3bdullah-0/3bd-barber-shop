<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3BD Barber Shop | Management Dashboard</title>
  <link rel="stylesheet" href="styles.css" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>

<body>
  <!-- AUTH -->
  <div id="auth-screen">
    <div class="auth-box">
      <h1 class="mb-4" style="color: var(--accent);">3BD Barber Shop</h1>
      <p class="mb-4">Management System Login</p>

      <form id="login-form">
        <input type="text" id="username" placeholder="Username" required autocomplete="off" />
        <input type="password" id="password" placeholder="Password" required />
        <button type="submit" class="btn btn-primary" style="width: 100%;">Login to Dashboard</button>
      </form>

      <p id="auth-error" class="text-danger mt-4" style="display:none; font-size:0.9rem;"></p>
    </div>
  </div>

  <!-- APP -->
  <div id="app" style="display:none;">
    <header class="top-bar">
      <div class="brand" onclick="app.navigate('home')">
        <span>‚úÇÔ∏è</span> 3BD Barber Shop
      </div>
      <div class="user-menu">
        <span id="current-date"></span>
        <button class="btn-logout" onclick="auth.logout()">Log Out</button>
      </div>
    </header>

    <main>
      <!-- HOME -->
      <section id="home-section" class="section active">
        <div class="dashboard-grid">
          <div class="card" onclick="app.navigate('bookings')">
            <div class="card-icon">üìÖ</div>
            <h2>Bookings</h2>
            <p>Manage appointments & schedule</p>
          </div>

          <div class="card" onclick="app.navigate('inventory')">
            <div class="card-icon">üì¶</div>
            <h2>Inventory</h2>
            <p>Track products & supplies</p>
          </div>

          <div class="card" onclick="app.navigate('cameras')">
            <div class="card-icon">üìπ</div>
            <h2>Cameras</h2>
            <p>Monitor shop in real-time</p>
          </div>

          <div class="card" onclick="app.navigate('accounting')">
            <div class="card-icon">üí∞</div>
            <h2>Accounting</h2>
            <p>Track income & expenses</p>
          </div>
        </div>

        <div class="dashboard-grid" style="margin-top: 1rem; grid-template-columns: 1fr;">
          <div class="card bot-card" onclick="app.navigate('bot')">
            <div class="card-icon bot-icon">ü§ñ</div>
            <div class="bot-info">
              <h2>Instagram Bot</h2>
              <p>Auto-reply & Booking Automation: <span id="bot-status-badge" class="badge-success">ACTIVE</span></p>
              <div class="bot-sub">Click to configure & view logs</div>
            </div>
          </div>
        </div>
      </section>

      <!-- BOOKINGS -->
      <section id="bookings-section" class="section">
        <div class="section-header">
          <div>
            <button class="back-btn" onclick="app.navigate('home')">‚Üê Dashboard</button>
            <h2>Bookings & Schedule</h2>
          </div>
          <button class="btn btn-primary" onclick="bookings.openModal()">+ New Booking</button>
        </div>

        <div class="flex-between mb-4">
          <button class="btn btn-secondary" onclick="bookings.prevWeek()">Previous Week</button>
          <h3 id="calendar-week-label">Week</h3>
          <button class="btn btn-secondary" onclick="bookings.nextWeek()">Next Week</button>
        </div>

        <div class="table-container" style="max-height: 70vh; overflow:auto;">
          <div id="bookings-calendar"></div>
        </div>
      </section>

      <!-- INVENTORY -->
      <section id="inventory-section" class="section">
        <div class="section-header">
          <div>
            <button class="back-btn" onclick="app.navigate('home')">‚Üê Dashboard</button>
            <h2>Inventory Management</h2>
          </div>

          <div style="display:flex; gap:1rem;">
            <input type="text" id="inventory-search" placeholder="Search or Scan Barcode..." style="margin-bottom:0; width:300px;" />
            <button class="btn btn-primary" onclick="inventory.openModal()">+ Add Product</button>
          </div>
        </div>

        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Product Name</th>
                <th>Quantity</th>
                <th>Price</th>
                <th>Total Value</th>
                <th>Last Updated</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="inventory-table-body"></tbody>
          </table>
        </div>
      </section>

      <!-- CAMERAS -->
      <section id="cameras-section" class="section">
        <div class="section-header">
          <div>
            <button class="back-btn" onclick="app.navigate('home')">‚Üê Dashboard</button>
            <h2>Security Cameras</h2>
          </div>
          <button class="btn btn-secondary" onclick="cameras.refreshAll()">Refresh Feeds</button>
        </div>

        <div class="camera-grid" id="camera-grid"></div>
      </section>

      <!-- ACCOUNTING -->
      <section id="accounting-section" class="section">
        <div class="section-header">
          <div>
            <button class="back-btn" onclick="app.navigate('home')">‚Üê Dashboard</button>
            <h2>Accounting & Cash</h2>
          </div>
          <div style="display:flex; gap:0.5rem;">
            <button class="btn btn-danger" onclick="accounting.openTransactionModal('expense')">- Add Expense</button>
            <button class="btn btn-primary" onclick="accounting.openTransactionModal('income')">+ Add Income</button>
          </div>
        </div>

        <div class="dashboard-grid" style="grid-template-columns:repeat(3,1fr); gap:1rem; margin-bottom:2rem; min-height:auto;">
          <div class="card mini">
            <span class="label success">Total Income</span>
            <h2 id="total-income">$0.00</h2>
          </div>
          <div class="card mini">
            <span class="label danger">Total Expenses</span>
            <h2 id="total-expenses">$0.00</h2>
          </div>
          <div class="card mini">
            <span class="label accent">Net Balance</span>
            <h2 id="net-balance">$0.00</h2>
          </div>
        </div>

        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>Description</th>
                <th>Category</th>
                <th>Type</th>
                <th class="text-right">Amount</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="accounting-table-body"></tbody>
          </table>
        </div>
      </section>

      <!-- BOT -->
      <section id="bot-section" class="section">
        <div class="section-header">
          <div>
            <button class="back-btn" onclick="app.navigate('home')">‚Üê Dashboard</button>
            <h2 style="color:#c13584;">Instagram Bot Control</h2>
          </div>
          <button class="btn btn-secondary" onclick="bot.loadLogs()">‚Üª Refresh Logs</button>
        </div>

        <div class="grid-2">
          <div>
            <h3 class="mb-4">Activity Logs</h3>
            <div class="table-container" style="max-height:500px; overflow:auto; background:#000; border:1px solid #333;">
              <table style="font-family:monospace;">
                <thead>
                  <tr>
                    <th style="width:170px;">Time</th>
                    <th>Event</th>
                  </tr>
                </thead>
                <tbody id="bot-logs-body"></tbody>
              </table>
            </div>
          </div>

          <div>
            <h3 class="mb-4">Configuration</h3>
            <div class="card" style="align-items:flex-start; text-align:left; padding:1.5rem; cursor:default;">
              <form id="bot-settings-form" style="width:100%;">
                <label class="label-row">
                  Instagram Access Token
                  <span class="pill">Admin Only</span>
                </label>
                <input type="password" id="bot-token" placeholder="Paste Meta Graph API Token" style="font-size:0.9rem;" />

                <div class="status-box">
                  <strong>Status:</strong> <span id="bot-connection-status">Ready for Webhooks</span>
                </div>

                <button type="submit" class="btn btn-primary mt-4" style="background:#c13584; color:#fff; width:100%;">Save Settings</button>
              </form>

              <hr class="hr" />

              <h4>Resources</h4>
              <ul class="resources">
                <li>1. Meta Developer Portal</li>
                <li>2. Get <strong>Page Access Token</strong></li>
                <li>3. Paste it above to enable replies.</li>
              </ul>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- MODALS -->
  <div id="booking-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3>New Booking</h3>
        <button class="close-modal" onclick="bookings.closeModal()">√ó</button>
      </div>
      <form id="booking-form">
        <input type="hidden" id="booking-id" />

        <label>Customer Name</label>
        <input type="text" id="booking-customer" required />

        <label>Service</label>
        <select id="booking-service" required>
          <option value="Haircut">Haircut</option>
          <option value="Beard Trim">Beard Trim</option>
          <option value="Haircut & Beard">Haircut & Beard</option>
          <option value="Shave">Shave</option>
          <option value="Facial">Facial</option>
          <option value="Hair Dye">Hair Dye</option>
        </select>

        <div class="grid-2-mini">
          <div>
            <label>Date</label>
            <input type="date" id="booking-date" required />
          </div>
          <div>
            <label>Time</label>
            <select id="booking-time" required></select>
          </div>
        </div>

        <button type="submit" class="btn btn-primary" style="width:100%; margin-top:1rem;">Save Booking</button>
        <button type="button" id="btn-delete-booking" class="btn btn-danger" style="width:100%; margin-top:0.5rem; display:none;">Cancel Booking</button>
      </form>
    </div>
  </div>

  <div id="inventory-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3>Product Details</h3>
        <button class="close-modal" onclick="inventory.closeModal()">√ó</button>
      </div>
      <form id="inventory-form">
        <input type="hidden" id="product-id" />

        <label>Product Name</label>
        <input type="text" id="product-name" required />

        <div class="grid-2-mini">
          <div>
            <label>Quantity</label>
            <input type="number" id="product-qty" min="0" required />
          </div>
          <div>
            <label>Price</label>
            <input type="number" id="product-price" min="0" step="0.01" required />
          </div>
        </div>

        <label>Barcode / QR (Optional)</label>
        <input type="text" id="product-barcode" />

        <button type="submit" class="btn btn-primary" style="width:100%; margin-top:1rem;">Save Product</button>
      </form>
    </div>
  </div>

  <div id="transaction-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 id="transaction-title">New Transaction</h3>
        <button class="close-modal" onclick="accounting.closeModal()">√ó</button>
      </div>
      <form id="transaction-form">
        <input type="hidden" id="trans-id" />
        <input type="hidden" id="trans-type" />

        <label>Amount</label>
        <input type="number" id="trans-amount" min="0" step="0.01" required style="font-size:1.5rem;" />

        <label>Description</label>
        <input type="text" id="trans-desc" required />

        <label>Category</label>
        <select id="trans-category"></select>

        <button type="submit" class="btn btn-primary" style="width:100%; margin-top:1rem;">Record Transaction</button>
      </form>
    </div>
  </div>

  <!-- ‚úÖ Scripts (root) -->
  <script src="auth.js"></script>
  <script src="app.js"></script>
  <script src="bookings.js"></script>
  <script src="inventory.js"></script>
  <script src="cameras.js"></script>
  <script src="accounting.js"></script>
  <script src="bot.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      auth.init();
      app.init();
    });
  </script>
</body>
</html>
